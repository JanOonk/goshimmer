
# Evil spammer

Evil spammer is the cli tool placed in `tools/evil-spammer` that allows to easily spam and stress test the network. It utilises client libraries `evilwallet` and `evilspammer`. Many predefined conflict and non-conflict scenarios are available to use directly with the `evilwallet` package, by command lines arguments of Evil Spammer tool, and by its interactive mode.

The main goal is to test how the network will handle more complicated spam scenarios and find as many bugs as possible!

**Main features:**
- easily spam and stress test the GoShimmer network with the predefined scenarios
- ability to enable deep spam mode that reuses outputs created during the spam
- spamming with the command lines
- spamming with the interactive mode

*If you have any idea on some nice scenarios, do not hesitate to open the PR, and we can extend our list with your ideas!
Also, do not forget to choose the right name for your spam.*

## How to be evil?
There are many options, but we encorage you to use our Evil Spammer Tool. It is available in a form of command line tool and in the interactive mode.

### Evil spammer command line
The tool starts with the `main.go` file in `tools/evil-spammer`.

Currently available script names:
- `basic`
- `quick`
- `interactive`

Run `go run . <SCRIPT_NAME> --help` to get the list of parameters available for each script and their descriptions.

**Basic spammer.**
Basic spammer can be run with:
```shell
cd tools/evil-spammer
go run . basic
```
and providing spam parameters with flags.
Below is an example with custom spam:
```shell
# under tools/evil-spammer
go run . basic --spammers custom --scenario <scenario-name> --rates 10 --durations 1m
```

It is possible to start multiple spam types at once by providing parameters separated by commas.
```shell
go run . basic --urls http://localhost:8080 --spammers ds,msg,custom --rates 5,10,2 --durations 20s,20s,20s --tu 1s --scenario peace
```

#### Quick Test
Can be used for fast and intense spamming test. First is transaction spam, next data spam, which should reduce the tip pool size if there was any, and double spend at the end.

Example usage:
```shell
# under tools/evil-spammer
go run . quick --urls http://localhost:8080,http://localhost:8090 --rate 50 --durations 1m --tu 1s --dbc 100ms
```
### Go interactive!

Simply run
```shell
# under tools/evil-spammer
go run . interactive
```

Evil wallet will start with API endpoints configured for the local docker network,
**if you want to play with different nodes on different network you need to update urls** in the config.json file and restart the tool,
or update it directly in the settings menu.

To correctly execute N-spend (a conflict set with size N) in scenarios, you need to provide at least N distinct urls to issue them simultaneously. The evil tool will pop an warning if more urls are needed.
E.g. to correctly spam with _`pear`_ you should have 4 clients configured.

**Notes:**
- Saving the evil wallet states is not supported. But don't worry you still can request more fresh Faucet outputs with just one click!
- Wallet will generate a `config.json` file if it did not exist. You can use it to set up your favorite settings or webAPI urls.
- We encourage you to see the results of your spams and structures in the DAGs Visualizer that by default can be accessed on port `8061`.
- Spammer allows for max 5 concurrently running spams, you can check currently running spams and cancel them at any time.
- Spammer tool keeps track of your last spams history, so you can check the times of the spam and render a specific period with the visualizer.
- In spam options you can enable `deep` spam, in which the spammer will reuse outputs generated by the current spam, previous spams with `reuse` option enabled, and previous deep spams' outputs.
- By default, the spam rate is set to mps but you can change the time unit in the config file, e.g. `"timeUnit": "1m"` for message per minute.

## Predefined scenarios
Below you can find a list of predefined scenarios.
- in the client library they can be accessed by the function `GetScenario(scenarioName string) (batch EvilBatch, ok bool)`
- in the evil spammer tool with command line you can use `basic` option and `scenario` flag to choose the scenario by name.
- in the evil spammer tool with interactive mode simply go to `New Spam -> Change scenario` and select from the list.

##### No conflicts
- `single-tx`

![Single transaction](/img/tooling/evil_spammer/evil-scenario-tx.png "Single transaction")

- `peace`

![Peace](/img/tooling/evil_spammer/evil-scenario-peace.png "Peace")

##### Conflicts
- `ds`

![Double spend](/img/tooling/evil_spammer/evil-scenario-ds.png "Double spend")

- `conflict-circle`

![Conflict circle](/img/tooling/evil_spammer/evil-scenario-conflict-circle.png "Conflict circle")

- `guava`

![Guava](/img/tooling/evil_spammer/evil-scenario-guava.png "Guava")

- `orange`

![Orange](/img/tooling/evil_spammer/evil-scenario-orange.png "Orange")

- `mango`

![Mango](/img/tooling/evil_spammer/evil-scenario-mango.png "Mango")

- `pear`

![Pear](/img/tooling/evil_spammer/evil-scenario-pear.png "Pear")

- `lemon`

![Lemon](/img/tooling/evil_spammer/evil-scenario-lemon.png "Lemon")

- `banana`

![Banana](/img/tooling/evil_spammer/evil-scenario-banana.png "Banana")

- `kiwi`

![Kiwi](/img/tooling/evil_spammer/evil-scenario-kiwi.png "Kiwi")


## Evil Wallet and Evil spammer lib
    This section is a guide for the users that wants to create their own tools or scenarios
    with the `evilwallet` and `evilwallet` library.
    If you simply want to spam, you can use the evil spammer tool and its interactive mode described above.

The wallet library was designed with the focus on the spamming use cases.
The evil wallet is a collection of many wallets (many seeds) that can be provided by the user, build from the faucet requests or are created during the spam.

While creating the wallet we can provide the nodes webAPI urls, that will be ordered to spam. Otherwise, it will use default endpoints for the local docker network.
```go
// provide webAPI urls
evilWallet := evilwallet.NewEvilWallet("http://localhost:1234", "http://localhost:2234")

// automatically adds docker network as endpoints.
evilWallet := evilwallet.NewEvilWallet()
```

### Request funds from the faucet
Then in order to send transactions, we need to request funds from the Faucet.
The evil wallet sends the request and splits the received funds on requested number of outputs that are further used as inputs for the spamming batches.

Evil spammer does not care about the value of sent transactions,
it simply splits the input value equally among the outputs during the spam.
Below are presented all possibilities for requesting funds.
Requesting more allows you to spam harder, but you need to wait more for outputs preparation.
```go
// 100 ouptuts
evilwallet.RequestFreshFaucetWallet()

// 10k outputs
evilwallet.RequestFreshBigFaucetWallet()

// x * 10k outputs
evilwallet.RequestFreshBigFaucetWallets(x)
```

